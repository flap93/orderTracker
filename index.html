<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Registro de Horas y Pedidos</title>
        <script>
            const style = document.createElement("style");
            style.innerHTML = `
  body {
    font-family: Arial, sans-serif;
    max-width: 400px;
    margin: auto;
    padding: 20px;
    background-color: #f4f4f4;
  }
  h2, h3 {
    text-align: center;
  }
  form {
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }
  label {
    display: block;
    margin-bottom: 10px;
  }
  input {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }
  button {
    width: 100%;
    padding: 10px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 10px;
  }
  button:hover {
    background: #218838;
  }
  table {
    width: 100%;
    background: white;
    border-collapse: collapse;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
  }
  th {
    background: #007bff;
    color: white;
  }
  td button {
    background: #dc3545;
    border: none;
    padding: 5px;
    color: white;
    cursor: pointer;
    border-radius: 3px;
  }
  td button:hover {
    background: #c82333;
  }
`;
            document.head.appendChild(style);
            document.addEventListener("DOMContentLoaded", function () {
                const app = document.createElement("div");
                app.id = "app";
                document.body.appendChild(app);

                app.innerHTML = `
                <h2>Registro de Horas y Pedidos</h2>
                <form id="workForm">
                    <label>Fecha: <input type="date" id="date"></label>
                    <label>Hora de inicio: <input type="time" id="startTime"></label>
                    <label>Hora de fin: <input type="time" id="endTime"></label>
                    <label>Pedidos realizados: <input type="number" id="orders" min="0"></label>
                    <button type="submit">Guardar</button>
                </form>
                <h3>Historial</h3>
                <table>
                    <thead>
                        <tr><th>Fecha</th><th>Horas Trabajadas</th><th>Pedidos</th><th>Acciones</th></tr>
                    </thead>
                    <tbody id="history"></tbody>
                </table>
                <h3>Resumen Mensual</h3>
                <div id="monthlySummary"></div>
            `;

                const workForm = document.getElementById("workForm");
                const historyTable = document.getElementById("history");
                const monthlySummary = document.getElementById("monthlySummary");

                let workData = JSON.parse(localStorage.getItem("workData")) || [];

                function calculateHours(startTime, endTime) {
                    const start = new Date(`2000-01-01T${startTime}`);
                    const end = new Date(`2000-01-01T${endTime}`);

                    if (end < start) end.setDate(end.getDate() + 1); // Maneja turnos nocturnos

                    const diffMs = end - start;
                    return diffMs / (1000 * 60 * 60); // Convertir a horas
                }

                function updateUI() {
                    historyTable.innerHTML = "";
                    const monthlyTotals = {};

                    workData.forEach((entry, index) => {
                        const month = entry.date.slice(0, 7);
                        if (!monthlyTotals[month]) {
                            monthlyTotals[month] = { hours: 0, orders: 0 };
                        }
                        monthlyTotals[month].hours += entry.hours;
                        monthlyTotals[month].orders += entry.orders;

                        const row = document.createElement("tr");
                        row.innerHTML = `
                        <td>${entry.date}</td>
                        <td>${entry.hours.toFixed(2)}</td>
                        <td>${entry.orders}</td>
                        <td>
                            <button onclick="editEntry(${index})">Editar</button>
                            <button onclick="deleteEntry(${index})">Eliminar</button>
                        </td>
                    `;
                        historyTable.appendChild(row);
                    });

                    monthlySummary.innerHTML = "";
                    for (const month in monthlyTotals) {
                        const monthDiv = document.createElement("div");
                        monthDiv.innerHTML = `<h4>${month}</h4><p>Total Horas: ${monthlyTotals[month].hours.toFixed(
                            2
                        )}</p><p>Total Pedidos: ${monthlyTotals[month].orders}</p>`;
                        monthlySummary.appendChild(monthDiv);
                    }
                }

                workForm.addEventListener("submit", (e) => {
                    e.preventDefault();
                    const date = document.getElementById("date").value;
                    const startTime = document.getElementById("startTime").value;
                    const endTime = document.getElementById("endTime").value;
                    const orders = parseInt(document.getElementById("orders").value) || 0;

                    if (!date || !startTime || !endTime) return alert("Completa todos los campos.");

                    const hoursWorked = calculateHours(startTime, endTime);

                    workData.push({ date, hours: hoursWorked, orders });
                    localStorage.setItem("workData", JSON.stringify(workData));
                    updateUI();
                    workForm.reset();
                });

                window.editEntry = function (index) {
                    const entry = workData[index];
                    document.getElementById("date").value = entry.date;
                    document.getElementById("startTime").value = entry.startTime;
                    document.getElementById("endTime").value = entry.endTime;
                    document.getElementById("orders").value = entry.orders;
                    deleteEntry(index);
                };

                window.deleteEntry = function (index) {
                    workData.splice(index, 1);
                    localStorage.setItem("workData", JSON.stringify(workData));
                    updateUI();
                };

                updateUI();
            });
        </script>
    </head>
    <body></body>
</html>
